
{
  "rules": {
    "institutions": {
      "$institutionId": {
        ".write": "auth != null && ( (newData.child('ownerId').val() === auth.uid && !data.exists()) || (data.child('ownerId').val() === auth.uid) )",
        ".read": "auth != null && (data.child('ownerId').val() === auth.uid || root.child('userMappings').child(auth.uid).child($institutionId).exists())",

        "roles": { ".read": "auth != null", ".write": "auth != null && (data.parent().child('ownerId').val() === auth.uid || root.child('userMappings').child(auth.uid).child($institutionId).child('roleId').val() === 'admin')" },
        "customers": { ".read": "auth != null", ".write": "auth != null" },
        "suppliers": { ".read": "auth != null", ".write": "auth != null" },
        "business-partners": { ".read": "auth != null", ".write": "auth != null" },
        "transactions": { ".read": "auth != null", ".write": "auth != null" },
        "purchases": { ".read": "auth != null", ".write": "auth != null" },
        "purchase-returns": { ".read": "auth != null", ".write": "auth != null" },
        "expenses": { ".read": "auth != null", ".write": "auth != null" },
        "other-incomes": { ".read": "auth != null", ".write": "auth != null" },
        "investments": { ".read": "auth != null", ".write": "auth != null" },
        "cash-advances": { ".read": "auth != null", ".write": "auth != null" },
        "customer-payments": { ".read": "auth != null", ".write": "auth != null" },
        "supplier-payments": { ".read": "auth != null", ".write": "auth != null" },
        "employees": { ".read": "auth != null", ".write": "auth != null" },
        "bank-accounts": { ".read": "auth != null", ".write": "auth != null" },
        "tank-readings": { ".read": "auth != null", ".write": "auth != null" },
        "settings": { ".read": "auth != null", ".write": "auth != null" }
      }
    },
    "userMappings": {
       "$userId": {
         ".read": "auth != null && auth.uid === $userId",
         ".write": "auth != null && root.child('institutions').child(newData.parent().key()).child('ownerId').val() === auth.uid"
       }
    }
  }
}
