
{
  "rules": {
    "app_settings": {
      ".read": true,
      "isSuperAdminRegistered": {
        ".write": "auth != null"
      }
    },
    "institutions": {
      ".read": "auth != null",
      "$institutionId": {
        ".write": "auth != null && (!data.exists() || data.child('ownerId').val() === auth.uid)",
        ".read": "auth != null && (data.child('ownerId').val() === auth.uid || root.child('userMappings').child(auth.uid + '_' + $institutionId).exists())",
        
        "roles": {
          ".read": "auth != null",
          "$roleId": {
            ".write": "root.child('institutions/' + $institutionId + '/ownerId').val() === auth.uid || root.child('userMappings').child(auth.uid + '_' + $institutionId).child('roleId').val() === 'admin'"
          }
        },
        
        "userMappings": {
          ".read": "auth != null",
          "$mappingId": {
            ".write": "root.child('institutions/' + $institutionId + '/ownerId').val() === auth.uid || root.child('userMappings').child(auth.uid + '_' + $institutionId).child('roleId').val() === 'admin'"
          }
        },

        "customers": { ".read": "auth != null", ".write": "auth != null" },
        "suppliers": { ".read": "auth != null", ".write": "auth != null" },
        "business-partners": { ".read": "auth != null", ".write": "auth != null" },
        "transactions": { ".read": "auth != null", ".write": "auth != null" },
        "purchases": { ".read": "auth != null", ".write": "auth != null" },
        "purchase-returns": { ".read": "auth != null", ".write": "auth != null" },
        "expenses": { ".read": "auth != null", ".write": "auth != null" },
        "other-incomes": { ".read": "auth != null", ".write": "auth != null" },
        "investments": { ".read": "auth != null", ".write": "auth != null" },
        "cash-advances": { ".read": "auth != null", ".write": "auth != null" },
        "customer-payments": { ".read": "auth != null", ".write": "auth != null" },
        "supplier-payments": { ".read": "auth != null", ".write": "auth != null" },
        "employees": { ".read": "auth != null", ".write": "auth != null" },
        "bank-accounts": { ".read": "auth != null", ".write": "auth != null" },
        "tank-readings": { ".read": "auth != null", ".write": "auth != null" },
        "settings": { ".read": "auth != null", ".write": "auth != null" }
      }
    },
    "userMappings": {
       ".read": false,
       "$mappingId": {
         ".read": "auth != null && auth.uid === data.child('userId').val()",
         ".write": "auth != null && (root.child('institutions/' + data.child('institutionId').val() + '/ownerId').val() === auth.uid || root.child('userMappings').child(auth.uid + '_' + data.child('institutionId').val()).child('roleId').val() === 'admin')"
       }
    }
  }
}
